# 主站重构可行性分析报告

## 前言

目前主站代码基于武汉 `keke` 公司早期交付版本更新迭代,由于该版本没有框架概念,不能很好地复用 `php` 社区的组件生态,很大程度上影响了开发效率,时过境迁,伴随着项目开发人员的更替,主站越来越难以维护,没有人能说清整个系统，甚至于一半的功能都相当的困难.

岁月在积累年轮的同时,也积累了越来越多无法偿还的技术债,由于外包团队交付的版本更多地只考虑功能实现,缺乏软件工程思想,业务逻辑实现只是面向过程的堆叠代码;各模块、函数、类之间没有清晰的切口.以至很小的改动可能导致牵一发而动全身.

正常的重构是在不改变软件可观察行为的前提下，提高可理解性，降低修改成本,尽量不影响业务。但主站历史包袱过重，导致了我们的系统需要一次大规模的重构。

## 目录
- 为什么重构？
  - 重构的动机
  - 重构的目的与价值
  - 重构不一定能解决的问题
- 重构的可行性方案
  - `gitflow` 工作流
      - `master` 分支
      - `pull request` 合并请求流程
  - 成熟的持续集成环境支持
      - 基于 `drone` 的容器构建
      - 基于语义化发布的版本生成
      - 基于 `jenkins` 的线上部署
  - 系统架构重构
      - 成熟的开源框架及可复用组件生态
          - `laravel` 、 `hyperf`
          - `go-micro`
      - 开发规范
          - `php` 开发规范
          - `go` 语言开发规范
      - 单元测试
          - `phpunit`
          - `gotest`
      - 合理规划分层结构到代码实施
      - 区分好代码与坏代码
  - 服务架构重构
      - 基于容器的微服务架构 `k8s` 部署与容器编排
      - 基于容器的链路追踪与日志收集
- 重构模块评估与度量
    - 各模块划分
    - 人员评估
    - 各部门需协调的资源
- 后记

未完待续...